<!DOCTYPE html>
<html>
<head>
  <title>Pi Network SDK Example</title>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
</head>
<body>
  <h1>Pi Network SDK Example</h1>
  <p>Should initialize automatically now!</p>
  <button onclick="initialize()">Initialize</button>
  <button onclick="authenticate()">Authenticate</button>
  <button onclick="checkUserHasMiningApp()">Check if user has Mining App</button>
  <button onclick="checkUserHasPiBrowser()">Check if user has Pi Browser</button>
  <button onclick="copyText()">Copy text to clipboard</button>
  <button onclick="createPayment()">Create payment</button>
  <button onclick="getPiHostAppName()">Get Pi Host App Name</button>
  <button onclick="getPiHostAppInfo()">Get Pi Host App Info</button>
  <button onclick="nativeFeaturesList()">Get Native Features List</button>
  <button onclick="openConversation()">Open conversation</button>
  <button onclick="openShareDialog()">Open share dialog</button>
  <button onclick="openUrlInSystemBrowser()">Open URL in system browser</button>
  <button onclick="requestPermission()">Request permission</button>
  <button onclick="scanQrCode()">Scan QR code</button>

  <pre id="return">

  </pre>

  <script>
    const update_return = (text) => {
      document.getElementById("return").textContent=text.toString();
    };

    const initialize = () => {
      Pi.init({ version: "2.0", sandbox: false });
    };

    const authenticate = () => {
      Pi.authenticate(['payments'], (error, result) => {
        if (error) {
          update_return(error);
        } else {
          update_return(result);
        }
      });
    };

    const checkUserHasMiningApp = () => {
      Pi.checkUserHasMiningApp().then((result) => {
        update_return(result);
      });
    };

    const checkUserHasPiBrowser = () => {
      Pi.checkUserHasPiBrowser().then((result) => {
        update_return(result);
      });
    };

    const copyText = () => {
      Pi.copyText('Hello world!').then(() => {
        update_return('Text copied to clipboard.');
      });
    };

    const createPayment = () => {
      Pi.createPayment({
        amount: 10,
        memo: 'This is a test payment.',
        to_address: 'my_pi_address'
      }, (error, result) => {
        if (error) {
          update_return(error);
        } else {
          update_return(result);
        }
      });
    };

    const getPiHostAppName = () => {
      update_return(Pi.getPiHostAppName());
    };

    const getPiHostAppInfo = () => {
      Pi.getPiHostAppInfo().then((result) => {
        update_return(result);
      });
    };

    const nativeFeaturesList = () => {
      Pi.nativeFeaturesList().then((result) => {
        update_return(result);
      });
    };

    const openConversation = () => {
      Pi.openConversation('my_conversation_id').then(() => {
        update_return('Conversation opened.');
      });
    };

    const openShareDialog = () => {
      Pi.openShareDialog('My title', 'My sharing message').then(() => {
        update_return('Share dialog opened.');
      });
    };

    const openUrlInSystemBrowser = () => {
      Pi.openUrlInSystemBrowser('https://www.minepi.com').then(() => {
        update_return('URL opened in system browser.');
      });
    };

    const requestPermission = () => {
      Pi.requestPermission('camera').then((result) => {
        update_return(result);
      });
    };

    const scanQrCode = () => {
      Pi.scanQrCode().then((result) => {
        update_return(result);
      });
    };

    var interval = setInterval(function() {
      console.log('Interval Running');
      if( Pi == "undefined" || Pi == ""){
        //Do Something While Waiting / Spinner Gif etc.
      }else{
        console.log('Interval Stopped');
        clearInterval(interval);
        initialize();
      }
    }, 1000);
  </script>
</body>
</html>